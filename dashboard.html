<!doctype html>
<html lang="es">
<head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Dashboard - MardelMusic</title>
</head>
<body class="flex flex-col md:w-full h-screen md:overflow-hidden md:bg-[#242424]">
<nav class="flex flex-row p-8 bg-transparent h-20">
    <div class="grow justify-start">
        <a href="./index.html" class="text-2xl font-bold">
            MardelMusic
        </a>
    </div>

    <div class="grow-3 flex justify-center ">
        <div class="w-100 input-container">
            <div class="relative flex items-center">
                <input type="text" id="search-input" placeholder="Buscar eventos"
                       class="p-2 border border-gray-700 rounded bg-gray-800 text-white text-base focus:border-white focus:outline-none w-full shadow-md"/>
                <button type="button" class="absolute right-3" id="toggle-password">
                    <i data-lucide="Search"></i>
                </button>
            </div>
        </div>
    </div>

    <div class="grow-1 relative flex justify-end">
        <div class="relative">
            <button id="profile-img"
                    class="w-10 h-10 bg-white rounded-full flex items-center justify-center cursor-pointer">
            </button>

            <ul id="profile-dropdown"
                class="hidden absolute top-0 right-0 mt-12 md:w-50 md:h-auto bg-white text-black rounded shadow-lg flex flex-col gap-2">
                <li class="p-2 hover:bg-[#333333] hover:opacity-80 hover:text-white transition-all cursor-pointer">
                <span class="text-sm font-medium">
                    Mi perfil
                </span>
                </li>
                <li class="p-2 hover:bg-[#333333] hover:opacity-80 hover:text-white transition-all cursor-pointer">
                <span class="text-sm font-medium">
                    Configuración
                </span>
                </li>

                <li id="logout-btn"
                    class="p-2 hover:bg-[#333333] hover:opacity-80 hover:text-white transition-all cursor-pointer">
                <span class="text-sm font-medium">
                    Cerrar sesión
                </span>
                </li>
            </ul>
        </div>
    </div>
</nav>

<section
        class="bg-[#242424] backdrop:blur-2xl md:p-0  h-full grid grid-cols-1 md:grid-cols-4 border border-transparent">
</section>

<script type="module" src="/src/main.js"></script>
<script type="module">
    import DashboardHandler from '/src/handlers/dashboard-handler.js'

    const dashboardHandler = new DashboardHandler();


</script>
<script type="module">
    import ProfileHandler from '/src/handlers/profile.handler.js';

    const profileHandler = new ProfileHandler();
    const {user} = await profileHandler.getUser();

    const logoutBtn = document.getElementById('logout-btn');
    logoutBtn.addEventListener('click', async () => {
        await profileHandler.logout();
        window.location.href = '/index.html';
    });

    const profileBtn = document.getElementById('profile-img');
    if (!user.profile?.avatar_url) {
        const profileImg = document.createElement('span');
        profileImg.className = "text-lg font-bold text-black text-center";
        profileImg.textContent = user.name.substring(0, 1).toUpperCase() + user.lastName.substring(0, 1).toUpperCase();
        profileBtn.appendChild(profileImg)
    } else {
        const profileImg = document.createElement('img');
        profileImg.src = user.profile.avatar_url;
        profileImg.className = "w-full h-full object-cover rounded-full";
        profileBtn.appendChild(profileImg);
    }

    // En tu script del dashboard.html, reemplaza la parte del modal:
    if (user.role === "artist") {
        const dialog = document.createElement("dialog");
        dialog.className = "backdrop:bg-black backdrop:opacity-50 bg-transparent border-none outline-none";

        // Contenido del modal
        const modalContent = document.createElement("div");
        modalContent.className = "bg-white rounded-lg p-6 w-96 max-w-[90vw] shadow-xl";

        // Header del modal
        const header = document.createElement("div");
        header.className = "flex items-center justify-between mb-4";

        const title = document.createElement("h2");
        title.className = "text-xl font-bold text-gray-800";
        title.textContent = "¡Bienvenido Artista!";

        const closeButton = document.createElement("button");
        closeButton.className = "text-gray-500 hover:text-gray-700 text-xl font-bold";
        closeButton.innerHTML = "&times;";
        closeButton.addEventListener("click", () => dialog.close());

        header.appendChild(title);
        header.appendChild(closeButton);

        // Cuerpo del modal
        const body = document.createElement("div");
        body.className = "mb-6";

        if (!user.profile) {
            // Usuario sin perfil
            const message = document.createElement("p");
            message.className = "text-gray-600 mb-4";
            message.textContent = "Para comenzar a usar la plataforma, necesitas completar tu perfil de artista.";

            const createProfileBtn = document.createElement("button");
            createProfileBtn.className = "w-full bg-blue-600 text-white py-2 px-4 rounded hover:bg-blue-700 transition-colors";
            createProfileBtn.textContent = "Crear Perfil de Artista";
            createProfileBtn.addEventListener("click", () => {
                // Aquí puedes redirigir a la página de creación de perfil
                window.location.href = "/create-profile.html";
            });

            body.appendChild(message);
            body.appendChild(createProfileBtn);
        } else {
            // Usuario con perfil
            const message = document.createElement("p");
            message.className = "text-gray-600 mb-4";
            message.textContent = `¡Hola ${user.profile.artist_name}! Tu perfil está activo y listo para gestionar tus eventos.`;

            const manageBtn = document.createElement("button");
            manageBtn.className = "w-full bg-green-600 text-white py-2 px-4 rounded hover:bg-green-700 transition-colors mb-2";
            manageBtn.textContent = "Gestionar Eventos";
            manageBtn.addEventListener("click", () => {
                dialog.close();
                // Aquí puedes redirigir o mostrar la sección de eventos
            });

            const editProfileBtn = document.createElement("button");
            editProfileBtn.className = "w-full bg-gray-600 text-white py-2 px-4 rounded hover:bg-gray-700 transition-colors";
            editProfileBtn.textContent = "Editar Perfil";
            editProfileBtn.addEventListener("click", () => {
                // Redirigir a edición de perfil
                window.location.href = "/edit-profile.html";
            });

            body.appendChild(message);
            body.appendChild(manageBtn);
            body.appendChild(editProfileBtn);
        }

        // Footer del modal
        const footer = document.createElement("div");
        footer.className = "flex justify-end";

        const skipBtn = document.createElement("button");
        skipBtn.className = "text-gray-500 hover:text-gray-700 px-4 py-2";
        skipBtn.textContent = "Continuar sin cambios";
        skipBtn.addEventListener("click", () => dialog.close());

        footer.appendChild(skipBtn);

        // Ensamblar modal
        modalContent.appendChild(header);
        modalContent.appendChild(body);
        modalContent.appendChild(footer);
        dialog.appendChild(modalContent);

        // Agregar al DOM y mostrar
        document.body.appendChild(dialog);
        dialog.showModal();

        // Cerrar modal al hacer clic fuera de él
        dialog.addEventListener("click", (event) => {
            const rect = modalContent.getBoundingClientRect();
            const isInDialog = (rect.top <= event.clientY && event.clientY <= rect.top + rect.height &&
                rect.left <= event.clientX && event.clientX <= rect.left + rect.width);
            if (!isInDialog) {
                dialog.close();
            }
        });
    }

    const profileDropdown = document.getElementById('profile-dropdown');
    profileBtn.addEventListener('click', () => {
        profileDropdown.classList.toggle('hidden')
    });


</script>
</body>
</html>